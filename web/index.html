<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script src="/webpl/webpl.js" type="module"></script>
  <script src="/vendor/swipl/swipl-web.js"></script>

  <script type="module">
    import init, { Solver } from './webpl/webpl.js';

    const N_QUEENS = `take([H|T], H, T).
      take([H|T], R, [H|S]) :- take(T, R, S).
      perm([], []).
      perm(L, [H|R]) :- take(L, H, T), perm(T,R).
      generate_list(1, [1]).
      generate_list(N, [N|T]) :- N > 1, M is N - 1, generate_list(M, T).
      abs(0, 0).
      abs(N, N) :- N > 0.
      abs(N, M) :- N < 0, M is N * -1.
      n_queens(N, Qs) :- generate_list(N, Qs1), perm(Qs1, Qs), safe_queens(Qs).
      safe_queens([]).
      safe_queens([Q|Qs]) :- safe_queens(Qs, Q, 1), safe_queens(Qs).
      safe_queens([], Y, X).
      safe_queens([Q|Qs], Q0, D0) :- Q0 =\\= Q, Diff is Q0 - Q, abs(Diff, AbsDiff), AbsDiff =\\= D0, D1 is D0 + 1, safe_queens(Qs, Q0, D1).
    `;

    window.onload = () => {
      init();
      (async () => {
        const swipl = await SWIPL({
          arguments: ["-q"],
          locateFile: path => `/vendor/swipl/${path}`
        });
        window.swipl = swipl;
      })();
      window.Solver = Solver;
    };

    window.bench = () => {
      const start = performance.now();
      let solver = new Solver(N_QUEENS, "n_queens(8, L).");
      console.log(solver.all());
      const end = performance.now();
      alert(`Time: ${end - start}ms`);
    };

    window.swiplbench = async () => {
      const start = performance.now();
      await window.swipl.prolog.load_string(N_QUEENS, "n_queens.pl");
      const query = "n_queens(8, L).";
      for (let x of window.swipl.prolog.query(query)) {
        console.log(x);
      }
      const end = performance.now();
      alert(`Time: ${end - start}ms`);
    };
  </script>

  <button onclick="bench()">WebPL</button>
  <button onclick="swiplbench()">SWIPL</button>
</body>
</html>